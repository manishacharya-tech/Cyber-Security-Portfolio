# Intrusion Detection Systems (IDS) - Suricata

> Suricata is a powerful open-source tool that serves as an intrusion detection system (IDS), intrusion prevention system (IPS), and network analysis platform.

> An IDS is a security application designed to monitor system and network activity, identifying and alerting on potential intrusions. These technologies enable organizations to detect signs of malicious activity, helping them safeguard their systems and networks effectively.

## Overview
There are three ways Suricata can be used: 
1. **Intrusion detection system (IDS):** Monitor network traffic and alert on suspicious activities and intrusions. In a practical way, it can be a host-based IDS to monitor system and network activities of a single host like a computer.
2. **Intrusion prevention system (IPS):** Detect and block malicious activity and traffic. It requires additional configuration such as enabling IPS mode.
3. **Network security monitoring (NSM):** Produce and save relevant network logs (live network traffic, existing packet capture files, full or conditional packet captures). This is beneficial for forensics, incident response and for testing signatures.

## Rules 
Rules or signatures are used to identify specific patterns, behavior, and conditions of network traffic that might indicate malicious activity. The terms rule and signature are often used interchangeably in Suricata. Security analysts use **signatures**, or patterns associated with malicious activity, to detect and alert on specific malicious activity. Rules can also be used to provide additional context and visibility into systems and networks, helping to identify potential security threats or vulnerabilities. 

Suricata uses **signatures analysis**, which is a detection method used to find events of interest. Signatures consist of three components:
1. **Action:** The first component of a signature. It describes the action to take if network or system activity matches the signature. Examples include: alert, pass, drop, or reject.
2. **Header:** The header includes network traffic information like source and destination IP addresses, source and destination ports, protocol, and traffic direction.
3. **Rule options:** The rule options provide you with different options to customize signatures.

![Suricata signature](https://github.com/user-attachments/assets/4f5f6188-b2fb-4a6e-a90c-edca0aeee97a)

## Scenario

In this scenario, you’re a security analyst who must monitor traffic on your employer's network. You’ll be required to configure Suricata and use it to trigger alerts.

Here’s how you'll do this task: **First**, you'll explore custom rules in Suricata. **Second**, you'll run Suricata with a custom rule in order to trigger it, and examine the output logs in the `fast.log` file. **Finally**, you’ll examine the additional output that Suricata generates in the standard `eve.json` log file.

For the purposes of the tests you’ll run in this lab activity, you’ve been supplied with a `sample.pcap` file and a `custom.rules` file. These reside in your home folder.

Let’s define the files: 

* The `sample.pcap` file is a packet capture file that contains an example of network traffic data, which you’ll use to test the Suricata rules. This will allow you to simulate and repeat the exercise of monitoring network traffic.
  
* The `custom.rules` file contains a custom rule when the lab activity starts. You’ll add rules to this file and run them against the network traffic data in the `sample.pcap` file.

* The `fast.log` file will contain the alerts that Suricata generates. The `fast.log` file is empty when the lab starts. Each time you test a rule, or set of rules, against the sample network traffic data, Suricata adds a new alert line to the `fast.log` file when all the conditions in any of the rules are met. The `fast.log` file can be located in the `/var/log/suricata` directory after Suricata runs.The `fast.log` file is considered to be a depreciated format and is not recommended for incident response or threat hunting tasks but can be used to perform quick checks or tasks related to quality assurance.

* The `eve.json` file is the main, standard, and default log for events generated by Suricata. It contains detailed information about alerts triggered, as well as other network telemetry events, in JSON format. The `eve.json` file is generated when Suricate runs, and can also be located in the `/var/log/suricata` directory.

When you create a new rule, you'll need to test the rule to confirm whether or not it worked as expected. You can use the `fast.log` file to quickly compare the number of alerts generated each time you run Suricata to test a signature against the `sample.pcap` file.

## Task 1. Examine a custom rule in Suricata

1. Use the `cat` command to display the rule in the `custom.rules` file

## Task 2. Trigger a custom rule in Suricata

Now that you are familiar with the composition of the custom Suricata rule, you must trigger this rule and examine the alert logs that Suricata generates.

1. List the files in the `/var/log/suricata` folder

2. Run suricata using the `custom.rules`  and `sample.pcap` files

3. List the files in the `/var/log/suricata` folder again

4. Use the `cat` command to display the `fast.log` file generated by Suricata

## Task 3. Examine eve.json output

1. Use the `cat` command to display the entries in the `eve.json` file

2. Use the `jq` command to display the entries in an improved format

3. Press **Q** to exit the `less` command and to return to the command-line prompt.

4. Use the `jq` command to extract specific event data from the `eve.json` file

5. Use the `jq` command to display all event logs related to a specific `flow_id` from the `eve.json` file. The `flow_id` value is a 16-digit number and will vary for each of the log entries. 

## Expectation 

* Develop and implement custom rules in Suricata.
* Analyze network traffic using packet capture (PCAP) files.
* Review and interpret output logs, including `fast.log` and `eve.json`.
